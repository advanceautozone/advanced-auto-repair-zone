<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Towing &amp; Roadside Assistance | Advanced Auto Repair Zone</title>
    <meta name="description" content="Towing and roadside assistance from Advanced Auto Repair Zone to get your vehicle safely to our auto repair shop.">
    <link rel="icon" type="image/png" href="images/logo-horizontal.png" />
    <link rel="stylesheet" href="css/styles.css" />
    <!-- Google Maps API -->
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDu_tj6EmgI40BTGl6AiXCeeNZ38jwGTMI&libraries=places"></script>

    <style>
        .pricing-section {
            background: #f5f5f7;
            padding: 3rem 0;
        }

        .pricing-info {
            background: white;
            padding: 2rem;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.08);
            margin-bottom: 3rem;
            max-width: 800px;
            margin-left: auto;
            margin-right: auto;
        }

        .pricing-info h2 {
            color: #1f1f1f;
            margin-bottom: 1.5rem;
            text-align: center;
        }

        .pricing-breakdown {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1.5rem;
            margin-top: 2rem;
        }

        .price-item {
            background: #f9f9f9;
            padding: 1.5rem;
            border-radius: 8px;
            border-left: 4px solid #e0242a;
        }

        .price-item h3 {
            color: #e0242a;
            font-size: 1.1rem;
            margin-bottom: 0.5rem;
        }

        .price-item .amount {
            font-size: 2rem;
            font-weight: 700;
            color: #1f1f1f;
        }

        .price-item p {
            color: #666;
            font-size: 0.9rem;
            margin-top: 0.5rem;
        }

        .calculator-box {
            background: white;
            padding: 2.5rem;
            border-radius: 12px;
            box-shadow: 0 8px 24px rgba(0,0,0,0.12);
            max-width: 700px;
            margin: 0 auto 3rem;
        }

        .calculator-box h3 {
            color: #1f1f1f;
            margin-bottom: 1.5rem;
            text-align: center;
            font-size: 1.5rem;
        }

        .form-group {
            margin-bottom: 1.5rem;
        }

        .form-group label {
            display: block;
            font-weight: 600;
            margin-bottom: 0.5rem;
            color: #333;
        }

        .form-group input {
            width: 100%;
            padding: 0.75rem;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 1rem;
            transition: border-color 0.3s;
        }

        .form-group input:focus {
            outline: none;
            border-color: #e0242a;
        }

        .calculate-btn {
            width: 100%;
            padding: 1rem;
            background: #e0242a;
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: background 0.3s;
        }

        .calculate-btn:hover {
            background: #b01b21;
        }

        .result-box {
            display: none;
            margin-top: 2rem;
            padding: 2rem;
            background: linear-gradient(135deg, #e0242a 0%, #b01b21 100%);
            color: white;
            border-radius: 12px;
            text-align: center;
        }

        .result-box.show {
            display: block;
            animation: slideIn 0.5s ease;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .result-distance {
            font-size: 1.2rem;
            margin-bottom: 1rem;
        }

        .result-breakdown {
            background: rgba(255,255,255,0.1);
            padding: 1rem;
            border-radius: 8px;
            margin: 1rem 0;
            text-align: left;
        }

        .result-breakdown div {
            display: flex;
            justify-content: space-between;
            margin: 0.5rem 0;
            font-size: 0.95rem;
        }

        .result-breakdown .total {
            border-top: 2px solid rgba(255,255,255,0.3);
            padding-top: 0.5rem;
            margin-top: 0.5rem;
            font-weight: 700;
            font-size: 1.1rem;
        }

        .result-price {
            font-size: 3rem;
            font-weight: 700;
            margin: 1rem 0;
        }

        .shop-info {
            background: #fff3cd;
            border: 2px solid #ffc107;
            padding: 1rem;
            border-radius: 8px;
            margin-bottom: 2rem;
            text-align: center;
        }

        .shop-info strong {
            color: #856404;
        }

        /* Map Styles */
        #map {
            width: 100%;
            height: 400px;
            border-radius: 8px;
            margin-bottom: 1.5rem;
            border: 2px solid #e0e0e0;
        }

        .map-instructions {
            background: #e3f2fd;
            border: 2px solid #2196f3;
            padding: 1rem;
            border-radius: 8px;
            margin-bottom: 1.5rem;
            text-align: center;
        }

        .map-instructions strong {
            color: #1565c0;
        }

        .location-toggle {
            display: flex;
            gap: 1rem;
            margin-bottom: 1.5rem;
            justify-content: center;
        }

        .toggle-btn {
            padding: 0.75rem 1.5rem;
            background: #f0f0f0;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
        }

        .toggle-btn.active {
            background: #e0242a;
            color: white;
            border-color: #e0242a;
        }

        .location-input-section {
            display: none;
        }

        .location-input-section.active {
            display: block;
        }

        .current-location-btn {
            background: #2196f3;
            color: white;
            border: none;
            padding: 0.75rem 1.5rem;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            margin-bottom: 1rem;
            width: 100%;
            transition: background 0.3s;
        }

        .current-location-btn:hover {
            background: #1976d2;
        }

        /* Towing Request Form */
        .request-form-section {
            background: white;
            padding: 2.5rem;
            border-radius: 12px;
            box-shadow: 0 8px 24px rgba(0,0,0,0.12);
            max-width: 700px;
            margin: 0 auto;
        }

        .request-form-section h3 {
            color: #1f1f1f;
            margin-bottom: 1.5rem;
            text-align: center;
            font-size: 1.5rem;
        }

        .form-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
        }

        textarea {
            width: 100%;
            padding: 0.75rem;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 1rem;
            min-height: 100px;
            font-family: inherit;
            resize: vertical;
        }

        textarea:focus {
            outline: none;
            border-color: #e0242a;
        }

        .urgent-badge {
            display: inline-block;
            background: #dc3545;
            color: white;
            padding: 0.25rem 0.75rem;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 600;
            margin-left: 0.5rem;
        }

        @media (max-width: 768px) {
            .pricing-breakdown {
                grid-template-columns: 1fr;
            }
            
            .form-row {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>

    <!-- Header -->
    <header class="site-header">
        <div class="container header-inner">
            <a href="index.html" class="logo">
                <img src="images/logo-horizontal.png" alt="Advanced Auto Repair Zone Auto Service Logo">
            </a>

            <button class="nav-toggle" aria-label="Toggle navigation">
                <span class="nav-toggle-line"></span>
                <span class="nav-toggle-line"></span>
                <span class="nav-toggle-line"></span>
            </button>

            <nav class="main-nav">
                <ul>
                    <li><a href="services.html">Services</a></li>
                    <li><a href="coupons.html">Coupons</a></li>
                    <li><a href="towing.html">Towing</a></li>
                    <li><a href="brakes.html">Brakes</a></li>
                    <li><a href="about.html">About Us</a></li>
                    <li><a href="contact.html">Contact</a></li>
                </ul>
            </nav>

            <div class="header-cta">
                <a href="tel:+17186742455" class="header-phone">Call: +17186742455</a>
                <a href="contact.html" class="btn btn-primary">Book Appointment</a>
                <a href="Login.html" class="btn btn-primary" id="loginButton">Login</a>
            </div>
        </div>
    </header>

    <main>
        <section class="page-hero">
            <div class="container">
                <h1>Towing &amp; Roadside Assistance <span class="urgent-badge">24/7 Available</span></h1>
                <p>Breakdowns happen. Advanced Auto Repair Zone can help arrange safe, professional towing so your vehicle gets to the right place.</p>
                <a href="tel:+17186742455" class="btn btn-primary">Emergency Call: +17186742455</a>
            </div>
        </section>

        <!-- Pricing Section -->
        <section class="pricing-section">
            <div class="container">
                <div class="pricing-info">
                    <h2>üìã Transparent Towing Rates</h2>
                    
                    <div class="pricing-breakdown">
                        <div class="price-item">
                            <h3>Base Rate (0-10 KM)</h3>
                            <div class="amount">$100</div>
                            <p>Covers pickup and delivery within 10 kilometers from our shop</p>
                        </div>

                        <div class="price-item">
                            <h3>Beyond 10 KM</h3>
                            <div class="amount">$15<span style="font-size: 1rem;">/km</span></div>
                            <p>Additional charge for each kilometer beyond 10 km radius</p>
                        </div>
                    </div>

                    <div style="margin-top: 2rem; padding: 1rem; background: #f0f9ff; border-radius: 8px; border-left: 4px solid #0369a1;">
                        <strong style="color: #0c5460;">Example Calculation:</strong><br>
                        <span style="color: #0c5460;">Distance: 15 KM ‚Üí Base $100 + (5 km √ó $15) = <strong>$175 total</strong></span>
                    </div>
                </div>

                <!-- Distance Calculator -->
                <div class="calculator-box">
                    <h3>üìç Calculate Your Towing Cost</h3>
                    
                    <div class="shop-info">
                        <strong>üè™ Our Shop Location:</strong><br>
                        Advanced Auto Repair Zone<br>
                        190-20 99th Ave, Hollis, NY 11423, United States<br>
                        Phone: +1 (718) 674-2455
                    </div>

                    <!-- Location Selection Toggle -->
                    <div class="location-toggle">
                        <button class="toggle-btn active" onclick="switchLocationMethod('map')" id="mapToggle">
                            üìç Select on Map
                        </button>
                        <button class="toggle-btn" onclick="switchLocationMethod('manual')" id="manualToggle">
                            ‚å®Ô∏è Enter Manually
                        </button>
                    </div>

                    <!-- Map Selection -->
                    <div id="mapSection" class="location-input-section active">
                        <div class="map-instructions">
                            <strong>Click on the map</strong> to select your vehicle location<br>
                            or use the button below to use your current location
                        </div>
                        
                        <button type="button" class="current-location-btn" onclick="useCurrentLocation()">
                            üìç Use My Current Location
                        </button>

                        <div id="map"></div>

                        <div id="selectedLocationInfo" style="display:none; padding: 1rem; background: #e8f5e9; border-radius: 8px; margin-bottom: 1rem;">
                            <strong style="color: #2e7d32;">Selected Location:</strong><br>
                            <span id="selectedAddress"></span><br>
                            <strong style="color: #2e7d32;">Distance:</strong> <span id="selectedDistance"></span> KM
                        </div>
                    </div>

                    <!-- Manual Entry -->
                    <div id="manualSection" class="location-input-section">
                        <form id="distanceCalculator">
                            <div class="form-group">
                                <label for="distance-input">Enter Distance from Shop (KM):</label>
                                <input 
                                    type="number" 
                                    id="distance-input" 
                                    name="distance" 
                                    placeholder="Enter distance in kilometers"
                                    min="0"
                                    step="0.1"
                                    required
                                >
                            </div>

                            <button type="submit" class="calculate-btn">
                                Calculate Cost
                            </button>
                        </form>
                    </div>

                    <div id="result-box" class="result-box">
                        <div class="result-distance" id="result-distance"></div>
                        <div class="result-breakdown" id="result-breakdown"></div>
                        <div class="result-price" id="result-price"></div>
                        <div style="font-size: 0.9rem; opacity: 0.9; margin-top: 1rem;">
                            ‚úì Professional and insured towing service<br>
                            ‚úì 24/7 emergency availability<br>
                            ‚úì No hidden fees
                        </div>
                    </div>
                </div>

                <!-- Towing Request Form -->
                <div class="request-form-section">
                    <h3>üöó Request Towing Service</h3>
                    
                    <form id="towingRequestForm">
                        <div class="form-row">
                            <div class="form-group">
                                <label for="req-name">Your Name *</label>
                                <input type="text" id="req-name" name="name" required>
                            </div>
                            <div class="form-group">
                                <label for="req-phone">Phone Number *</label>
                                <input type="tel" id="req-phone" name="phone" required>
                            </div>
                        </div>

                        <div class="form-group">
                            <label for="req-email">Email (Optional)</label>
                            <input type="email" id="req-email" name="email">
                        </div>

                        <div class="form-group">
                            <label for="req-location">Vehicle Location (Address) *</label>
                            <input type="text" id="req-location" name="location" placeholder="Enter pickup address or use map above" required>
                            <small style="color: #666;">Tip: Use the map calculator above to select your location</small>
                        </div>

                        <div class="form-row">
                            <div class="form-group">
                                <label for="req-distance">Distance (KM) *</label>
                                <input type="number" id="req-distance" name="distance" min="0" step="0.1" required readonly style="background: #f5f5f5;">
                                <small style="color: #666;">Auto-filled from map selection</small>
                            </div>
                            <div class="form-group">
                                <label for="req-vehicle">Vehicle Type *</label>
                                <input type="text" id="req-vehicle" name="vehicleType" placeholder="e.g., Sedan, SUV, Truck" required>
                            </div>
                        </div>

                        <div class="form-group">
                            <label for="req-issue">Issue Description (Optional)</label>
                            <textarea id="req-issue" name="issue" placeholder="Describe the problem (e.g., won't start, flat tire, accident)"></textarea>
                        </div>

                        <div class="form-group">
                            <label>
                                <input type="checkbox" id="req-urgent" name="urgent" style="width: auto; margin-right: 0.5rem;">
                                This is an emergency / urgent request
                            </label>
                        </div>

                        <!-- Honeypot -->
                        <div style="position: absolute; left: -9999px;">
                            <input type="text" name="website" tabindex="-1">
                        </div>

                        <button type="submit" class="calculate-btn">
                            Submit Towing Request
                        </button>
                    </form>
                </div>
            </div>
        </section>

        <section class="content">
            <div class="container two-column">
                <div>
                    <h2>When you need a tow</h2>
                    <p>If your vehicle won't start, is unsafe to drive, or has been in an accident, we'll help you get it to our shop so we can diagnose the problem and get you back on the road.</p>
                    <ul>
                        <li>Local and long-distance towing to our facility</li>
                        <li>Coordination with trusted towing partners</li>
                        <li>Light‚Äëduty and passenger vehicle towing</li>
                        <li>Drop‚Äëoff during or after business hours</li>
                        <li>Transparent pricing - no hidden fees</li>
                        <li>24/7 emergency towing available</li>
                        <li>Professional and insured operators</li>
                    </ul>

                    <h2>After-hours drop-off</h2>
                    <p>If your vehicle arrives after hours, simply leave your keys in our secure drop box and we'll contact you the next business day with an update.</p>
                </div>
                <div>
                    <img src="images/card-service-towing.jpeg" alt="Tow truck loading a car">
                </div>
            </div>
        </section>
    </main>

    <!-- Footer -->
    <footer class="site-footer">
        <div class="footer-top">
            <div class="container footer-grid">
                <div class="footer-column">
                    <h4>Auto Services</h4>
                    <ul>
                        <li><a href="services.html">Oil Change</a></li>
                        <li><a href="brakes.html">Brakes</a></li>
                        <li><a href="services.html">Wheel Alignment</a></li>
                        <li><a href="services.html">Battery Service</a></li>
                        <li><a href="services.html">Inspections</a></li>
                    </ul>
                </div>
                <div class="footer-column">
                    <h4>Offers &amp; Financing</h4>
                    <ul>
                        <li><a href="coupons.html">Coupons &amp; Specials</a></li>
                        <li><a href="coupons.html">Seasonal Offers</a></li>
                    </ul>
                </div>
                <div class="footer-column">
                    <h4>Company</h4>
                    <ul>
                        <li><a href="about.html">About Advanced Auto Repair Zone</a></li>
                    </ul>
                </div>
                <div class="footer-column footer-contact">
                    <h4>Contact</h4>
                    <ul>
                        <li>
                            <img src="icons/icon-phone.jpeg" alt="Phone icon">
                            <a href="tel:+17186742455">+17186742455</a>
                        </li>
                        <li>
                            <img src="icons/icon-email.jpeg" alt="Email icon">
                            <a href="mailto:advanceautozone25@gmail.com">advanceautozone25@gmail.com</a>
                        </li>
                        <li>
                            <img src="icons/icon-location.jpeg" alt="Location icon">
                            <span>190-20 99th Ave<br>Hollis, NY 11423, United States</span>
                        </li>
                        <li>
                            <img src="icons/icon-clock.jpeg" alt="Clock icon">
                            <span>Mon‚ÄìFri: 8am‚Äì6pm<br>Sat: 9am‚Äì3pm</span>
                        </li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="footer-bottom">
            <div class="container footer-bottom-inner">
                <p>&copy; <span id="current-year"></span> Advanced Auto Repair Zone. All rights reserved.</p>
                <div class="footer-bottom-links">
                    <a href="#">Privacy Policy</a>
                    <a href="#">Terms &amp; Conditions</a>
                </div>
            </div>
        </footer>
    
    <script src="js/config.js"></script>    
    <script src="js/session-manager.js"></script>
    <script src="js/main.js"></script>
    <script>
        const API_URL = window.API_URL || 'http://localhost:3000/api';

        // ========== SHOP LOCATION (Advanced Auto Repair Zone, Hollis, NY) ==========
        const SHOP_LOCATION = {
            lat: 40.7156,  // Hollis, NY coordinates
            lng: -73.7629,
            address: "190-20 99th Ave, Hollis, NY 11423, United States"
        };

        // Global variables
        let map;
        let shopMarker;
        let vehicleMarker;
        let directionsService;
        let directionsRenderer;
        let selectedDistance = 0;
        let selectedAddress = '';

        // ========== INITIALIZE GOOGLE MAP ==========
        function initMap() {
            // Create map centered on shop location
            map = new google.maps.Map(document.getElementById('map'), {
                center: SHOP_LOCATION,
                zoom: 12,
                mapTypeControl: true,
                streetViewControl: false
            });

            // Add shop marker (red)
            shopMarker = new google.maps.Marker({
                position: SHOP_LOCATION,
                map: map,
                title: 'Our Shop',
                icon: {
                    url: 'http://maps.google.com/mapfiles/ms/icons/red-dot.png'
                },
                animation: google.maps.Animation.DROP
            });

            // Add shop info window
            const shopInfoWindow = new google.maps.InfoWindow({
                content: '<div style="padding:10px;"><strong>üè™ Our Shop</strong><br>' + SHOP_LOCATION.address + '</div>'
            });
            
            shopMarker.addListener('click', () => {
                shopInfoWindow.open(map, shopMarker);
            });

            // Initialize directions service
            directionsService = new google.maps.DirectionsService();
            directionsRenderer = new google.maps.DirectionsRenderer({
                map: map,
                suppressMarkers: false
            });

            // Click on map to select vehicle location
            map.addListener('click', (event) => {
                placeVehicleMarker(event.latLng);
            });
        }

        // ========== PLACE VEHICLE MARKER ==========
        function placeVehicleMarker(location) {
            // Remove existing vehicle marker
            if (vehicleMarker) {
                vehicleMarker.setMap(null);
            }

            // Create new vehicle marker (blue)
            vehicleMarker = new google.maps.Marker({
                position: location,
                map: map,
                title: 'Vehicle Location',
                icon: {
                    url: 'http://maps.google.com/mapfiles/ms/icons/blue-dot.png'
                },
                animation: google.maps.Animation.DROP
            });

            // Calculate distance
            calculateDistance(location);

            // Get address from coordinates
            getAddressFromCoordinates(location);
        }

        // ========== CALCULATE DISTANCE ==========
        function calculateDistance(vehicleLocation) {
            const request = {
                origin: SHOP_LOCATION,
                destination: vehicleLocation,
                travelMode: 'DRIVING'
            };

            directionsService.route(request, (result, status) => {
                if (status === 'OK') {
                    directionsRenderer.setDirections(result);
                    
                    const route = result.routes[0];
                    const distanceInMeters = route.legs[0].distance.value;
                    const distanceInKm = (distanceInMeters / 1000).toFixed(2);
                    
                    selectedDistance = parseFloat(distanceInKm);
                    
                    // Update UI
                    document.getElementById('selectedDistance').textContent = distanceInKm;
                    document.getElementById('selectedLocationInfo').style.display = 'block';
                    
                    // Calculate and show cost
                    showCalculatedCost(selectedDistance);
                    
                    // Auto-fill in request form
                    document.getElementById('req-distance').value = distanceInKm;
                    
                    console.log('Distance calculated:', distanceInKm, 'km');
                } else {
                    alert('Could not calculate distance. Please try again.');
                }
            });
        }

        // ========== GET ADDRESS FROM COORDINATES ==========
        function getAddressFromCoordinates(location) {
            const geocoder = new google.maps.Geocoder();
            
            geocoder.geocode({ location: location }, (results, status) => {
                if (status === 'OK' && results[0]) {
                    selectedAddress = results[0].formatted_address;
                    document.getElementById('selectedAddress').textContent = selectedAddress;
                    
                    // Auto-fill in request form
                    document.getElementById('req-location').value = selectedAddress;
                }
            });
        }

        // ========== USE CURRENT LOCATION ==========
        function useCurrentLocation() {
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(
                    (position) => {
                        const currentLocation = {
                            lat: position.coords.latitude,
                            lng: position.coords.longitude
                        };
                        
                        map.setCenter(currentLocation);
                        placeVehicleMarker(currentLocation);
                    },
                    (error) => {
                        alert('Error getting your location: ' + error.message);
                    }
                );
            } else {
                alert('Geolocation is not supported by your browser.');
            }
        }

        // ========== SWITCH LOCATION METHOD ==========
        function switchLocationMethod(method) {
            // Update toggle buttons
            document.getElementById('mapToggle').classList.remove('active');
            document.getElementById('manualToggle').classList.remove('active');
            
            if (method === 'map') {
                document.getElementById('mapToggle').classList.add('active');
                document.getElementById('mapSection').classList.add('active');
                document.getElementById('manualSection').classList.remove('active');
            } else {
                document.getElementById('manualToggle').classList.add('active');
                document.getElementById('manualSection').classList.add('active');
                document.getElementById('mapSection').classList.remove('active');
            }
        }

        // ========== CALCULATE COST FUNCTION ==========
        function calculateCost(distance) {
            let cost = 100;
            let breakdown = {
                base: 100,
                extra: 0,
                extraKm: 0
            };

            if (distance > 10) {
                const extraKm = distance - 10;
                const extraCost = extraKm * 15;
                cost = 100 + extraCost;
                breakdown.extra = extraCost;
                breakdown.extraKm = extraKm;
            }

            return { cost, breakdown };
        }

        // ========== SHOW CALCULATED COST ==========
        function showCalculatedCost(distance) {
            const resultBox = document.getElementById('result-box');
            const { cost, breakdown } = calculateCost(distance);
            
            document.getElementById('result-distance').innerHTML = 
                `Distance from shop: <strong>${distance.toFixed(2)} KM</strong>`;
            
            let breakdownHTML = `
                <div>
                    <span>Base Rate (0-10 KM):</span>
                    <span>${breakdown.base}</span>
                </div>
            `;
            
            if (breakdown.extraKm > 0) {
                breakdownHTML += `
                    <div>
                        <span>Extra Distance (${breakdown.extraKm.toFixed(2)} km √ó $15):</span>
                        <span>${breakdown.extra.toFixed(2)}</span>
                    </div>
                `;
            }
            
            breakdownHTML += `
                <div class="total">
                    <span>Total Cost:</span>
                    <span>${cost.toFixed(2)}</span>
                </div>
            `;
            
            document.getElementById('result-breakdown').innerHTML = breakdownHTML;
            document.getElementById('result-price').textContent = `${cost.toFixed(2)}`;
            
            resultBox.classList.add('show');
        }

        // ========== MANUAL DISTANCE CALCULATOR ==========
        document.getElementById('distanceCalculator').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const distance = parseFloat(document.getElementById('distance-input').value);
            showCalculatedCost(distance);
            
            const resultBox = document.getElementById('result-box');
            resultBox.scrollIntoView({ behavior: 'smooth', block: 'center' });
        });

        // ========== TOWING REQUEST FORM ==========
        document.getElementById('towingRequestForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const form = e.target;
            const submitBtn = form.querySelector('button[type="submit"]');
            const originalText = submitBtn.textContent;
            
            // Get form data
            const formData = new FormData(form);
            const distance = parseFloat(formData.get('distance'));
            const { cost } = calculateCost(distance);
            
            const data = {
                name: formData.get('name'),
                phone: formData.get('phone'),
                email: formData.get('email') || '',
                service: 'Towing Service',
                location: formData.get('location'),
                distance: distance,
                vehicleType: formData.get('vehicleType'),
                issue: formData.get('issue') || '',
                urgent: formData.get('urgent') ? 'Yes' : 'No',
                estimatedCost: cost.toFixed(2),
                message: `Towing Request:\nLocation: ${formData.get('location')}\nDistance: ${distance} km\nVehicle: ${formData.get('vehicleType')}\nEstimated Cost: $${cost.toFixed(2)}\nIssue: ${formData.get('issue') || 'Not specified'}\nUrgent: ${formData.get('urgent') ? 'YES' : 'No'}`,
                preferredDate: new Date().toISOString()
            };
            
            // Check honeypot
            if (formData.get('website')) {
                console.log('Spam detected');
                return false;
            }
            
            submitBtn.disabled = true;
            submitBtn.textContent = 'Submitting...';
            
            try {
                const response = await fetch(API_URL + '/appointments', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(data)
                });
                
                const result = await response.json();
                
                if (response.ok) {
                    // Success modal
                    const modal = document.createElement('div');
                    modal.style.cssText = 
                        'position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);' +
                        'background:white;padding:30px 40px;border-radius:12px;' +
                        'box-shadow:0 10px 40px rgba(0,0,0,0.3);z-index:10000;' +
                        'max-width:400px;text-align:center;';
                    
                    modal.innerHTML = 
                        '<div style="font-size:48px;margin-bottom:15px;">‚úÖ</div>' +
                        '<div style="font-size:18px;font-weight:600;color:#155724;margin-bottom:10px;">Towing Request Received!</div>' +
                        '<div style="font-size:14px;color:#333;margin-bottom:10px;">Estimated Cost: <strong>$' + cost.toFixed(2) + '</strong></div>' +
                        '<div style="font-size:14px;color:#333;margin-bottom:20px;">We will contact you shortly at ' + data.phone + '</div>' +
                        '<button onclick="this.parentElement.remove();document.getElementById(\'overlay\').remove();" ' +
                        'style="background:#e0242a;color:white;border:none;padding:10px 25px;' +
                        'border-radius:5px;cursor:pointer;font-size:14px;font-weight:600;">OK</button>';
                    
                    const overlay = document.createElement('div');
                    overlay.id = 'overlay';
                    overlay.style.cssText = 
                        'position:fixed;top:0;left:0;right:0;bottom:0;' +
                        'background:rgba(0,0,0,0.5);z-index:9999;';
                    
                    document.body.appendChild(overlay);
                    document.body.appendChild(modal);
                    
                    form.reset();
                } else {
                    alert('‚ùå ' + (result.error || 'Failed to submit request. Please try again.'));
                }
            } catch (error) {
                console.error('Error:', error);
                alert('‚ùå Connection error. Please call us directly at +17186742455');
            } finally {
                submitBtn.disabled = false;
                submitBtn.textContent = originalText;
            }
        });

        // Auto-calculate when distance changes in towing form
        document.getElementById('req-distance').addEventListener('input', function() {
            const distance = parseFloat(this.value);
            if (distance > 0) {
                const { cost } = calculateCost(distance);
                const label = this.previousElementSibling;
                label.innerHTML = `Distance (KM) * <span style="color:#e0242a;font-weight:700;">‚Üí Cost: ${cost.toFixed(2)}</span>`;
            }
        });

        // ========== INITIALIZE MAP ON PAGE LOAD ==========
        window.addEventListener('load', () => {
            initMap();
        });
    </script>
</body>
</html>